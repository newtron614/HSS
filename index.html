<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"/>
  <title>ë¨¸ë¦¬/ì–¼êµ´/ëª©/ì–´ê¹¨ í†µì¦ ë¬¸ì§„ì§€</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1976d2">
  <link rel="apple-touch-icon" href="icon-192.png">
  <style>
    body {
      font-family: 'Nanum Gothic', sans-serif;
      background: #f0f4f8;
      padding: 5vw;
      font-size: 1.1rem;
      line-height: 1.8;
    }
    h1 {
      text-align: center;
      color: #003366;
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 2rem;
    }
    .question, #thankyou {
      display: none;
      background: #fff;
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }
    .question.active { display: block; }
    #thankyou { display:none; text-align:center; font-size:1.2rem; }
    .question strong {
      font-size: 1.2rem;
      font-weight: bold;
      display: block;
      margin-bottom: 1rem;
    }
    .button-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .option-button {
      background: #1976d2;
      color: #fff;
      border: none;
      padding: .8rem 1rem;
      font-size: 1rem;
      font-weight: bold;
      border-radius: .75rem;
      cursor: pointer;
      min-width: 40%;
      text-align: center;
      transition: background-color .3s;
    }
    .option-button.selected {
      background: #ff9800;
      color: #000;
    }
    .nav-button {
      background: #004ba0;
      color: #fff;
      font-size: 1rem;
      font-weight: bold;
      padding: .8rem 2rem;
      margin: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .pain-description {
      background: #fff6e5;
      padding: 1rem;
      border-left: 6px solid #ff9900;
      font-size: .95rem;
      color: #333;
      border-radius: 10px;
      margin-bottom: 1rem;
    }
    .pain-grid {
      display: grid;
      grid-template-columns: repeat(5,1fr);
      gap: 10px;
      margin-top: 1rem;
    }
    .score-button {
      background: #1976d2;
      color: #fff;
      border: none;
      padding: 1rem 0;
      font-size: 1.1rem;
      font-weight: bold;
      border-radius: .75rem;
      cursor: pointer;
      width: 100%;
      box-sizing: border-box;
      transition: background-color .3s;
    }
    .score-button.selected {
      background: #ff9800;
      color: #000;
    }
    .center {
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>ğŸ“‹ ë¨¸ë¦¬/ì–¼êµ´/ëª©/ì–´ê¹¨ í†µì¦ ë¬¸ì§„ì§€</h1>
  <form id="form">

    <!-- í™˜ìì •ë³´ ì…ë ¥(í™˜ìë²ˆí˜¸, ìƒë…„ì›”ì¼ 8ìë¦¬) -->
    <div class="question active" data-group="pid">
      <strong>í™˜ì ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</strong>
      <div class="center" style="margin-bottom:1rem;">
        <input
          type="text"
          id="patientIdInput"
          placeholder="í™˜ì ë²ˆí˜¸"
          style="font-size:1.2rem; padding:.7rem 1rem; border-radius:.5rem; border:1px solid #bbb; width:60%; text-align:center; margin-bottom:.7rem;"
          required
          maxlength="15"
        /><br>
        <input
          type="text"
          id="patientBirthInput"
          placeholder="ìƒë…„ì›”ì¼ 8ìë¦¬ (ì˜ˆ: 19900101)"
          style="font-size:1.2rem; padding:.7rem 1rem; border-radius:.5rem; border:1px solid #bbb; width:60%; text-align:center;"
          required
          maxlength="8"
          pattern="\d{8}"
          inputmode="numeric"
        />
        <div style="font-size:0.95rem; color:#888; margin-top:0.5rem;">
          ìƒë…„ì›”ì¼ì€ 8ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”. (ì˜ˆ: <b>19900101</b>)
        </div>
      </div>
    </div>

    <div class="question active" data-group="general">
      <strong>1. í†µì¦ ë¶€ìœ„ê°€ ì–´ë””ì¸ê°€ìš”? (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-value="face">ì–¼êµ´</button>
        <button type="button" class="option-button" data-value="neck">ëª©</button>
        <button type="button" class="option-button" data-value="shoulder">ì–´ê¹¨</button>
        <button type="button" class="option-button" data-value="plexus">íŒ” ì €ë¦¼ í¬í•¨</button>
      </div>
    </div>

    <div class="question" data-group="general">
      <strong>2. í†µì¦ì´ ì–¸ì œë¶€í„° ì‹œì‘ë˜ì—ˆë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="onset" data-value="sudden">ê°‘ìê¸° ë©°ì¹  ì „ë¶€í„°</button>
        <button type="button" class="option-button" data-name="onset" data-value="gradual">ì„œì„œíˆ ìˆ˜ì£¼~ìˆ˜ê°œì›” ì „ë¶€í„°</button>
        <button type="button" class="option-button" data-name="onset" data-value="recurrent">ë°˜ë³µì ìœ¼ë¡œ ìˆ˜ë…„ ì „ë¶€í„°</button>
        <button type="button" class="option-button" data-name="onset" data-value="trauma">ì™¸ìƒ/ìˆ˜ìˆ  ì´í›„</button>
      </div>
    </div>

    <div class="question" data-group="face">
      <strong>ì–¼êµ´: í†µì¦ ìœ„ì¹˜ëŠ” ì–´ë””ì¸ê°€ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="face_location" data-value="forehead">ì´ë§ˆÂ·ëˆˆ ì£¼ìœ„</button>
        <button type="button" class="option-button" data-name="face_location" data-value="cheek">ê´‘ëŒ€ë¼ˆ ë¶€ìœ„</button>
        <button type="button" class="option-button" data-name="face_location" data-value="jaw">í„±Â·ê·€ ë°‘</button>
      </div>
    </div>
    <div class="question" data-group="face">
      <strong>ì–¼êµ´: í†µì¦ íŠ¹ì„±ì€ ì–´ë–»ê²Œ ë‚˜íƒ€ë‚˜ë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="face_char" data-value="electric">ì „ê¸°ì¶©ê²© ê°™ì€ ë‹¨ë°œì„± ì°Œë¦¿í•¨</button>
        <button type="button" class="option-button" data-name="face_char" data-value="aching">ì§€ì†ì ì´ê³  ë¬µì§í•œ ìš±ì‹ ê±°ë¦¼</button>
        <button type="button" class="option-button" data-name="face_char" data-value="pressure">ì°Œë¥´ê±°ë‚˜ ì¥ì–´ì§œëŠ” ì–‘ìƒ</button>
      </div>
    </div>
    <div class="question" data-group="face">
      <strong>ì–¼êµ´: í†µì¦ì´ ì•…í™”ë˜ëŠ” ìœ ë°œ ìš”ì¸ì€?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="face_trigger" data-value="cold">ë°”ëŒÂ·ì°¬ê³µê¸° ë…¸ì¶œ ì‹œ</button>
        <button type="button" class="option-button" data-name="face_trigger" data-value="chew">ì”¹ê±°ë‚˜ ë§í•  ë•Œ</button>
        <button type="button" class="option-button" data-name="face_trigger" data-value="wash">ì„¸ì•ˆÂ·ì–‘ì¹˜ ì‹œ</button>
      </div>
    </div>
    <div class="question" data-group="face">
      <strong>ì–¼êµ´: ë™ë°˜ ì¦ìƒì´ ìˆë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="face_symp" data-value="sensory">ì•ˆë©´ ê°ê° ì €í•˜/ì €ë¦¼</button>
        <button type="button" class="option-button" data-name="face_symp" data-value="tearing">ëˆˆë¬¼Â·ì½§ë¬¼ ê³¼ë‹¤</button>
        <button type="button" class="option-button" data-name="face_symp" data-value="hearing">ì²­ë ¥ ì´ìƒ</button>
        <button type="button" class="option-button" data-name="face_symp" data-value="jaw_lock">í„±ê´€ì ˆ ì… ë²Œë¦¼ ì œí•œ</button>
      </div>
    </div>
    <div class="question" data-group="face">
      <strong>ì–¼êµ´: ê´€ë ¨ ê³¼ê±° ë³‘ë ¥ì´ ìˆë‚˜ìš”?(ì—†ìœ¼ë©´ ë‹¤ìŒ)</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="face_hist" data-value="zoster">ëŒ€ìƒí¬ì§„ ê³¼ê±°ë ¥</button>
        <button type="button" class="option-button" data-name="face_hist" data-value="bell">ì•ˆë©´ë§ˆë¹„Â·êµ¬ìˆœí¬ì§„</button>
        <button type="button" class="option-button" data-name="face_hist" data-value="dental">ì¹˜ê³¼ ì‹œìˆ Â·í„±ê´€ì ˆ ì¥ì• </button>
      </div>
    </div>

    <div class="question" data-group="neck">
        <strong>ëª©: í†µì¦ ìœ„ì¹˜ëŠ” ì–´ë””ì¸ê°€ìš”?</strong>
        <div class="button-grid">
          <button type="button" class="option-button" data-name="neck_location" data-value="í›„ë‘ë¶€">
            í›„ë‘ë¶€<br>
            <img src="image/neck_suboccipital.png.png" alt="í›„ë‘ë¶€" style="height: 160px;vertical-align:middle;">
          </button>
          <button type="button" class="option-button" data-name="neck_location" data-value="ë’¤ ì˜†">
            ì¸¡ë©´<br>
            <img src="image/neck_lateral.png" alt="ì¸¡ë©´" style="height: 160px;vertical-align:middle;">
          </button>
          <button type="button" class="option-button" data-name="neck_location" data-value="ì•">
            ì „ë°©<br>
            <img src="image/neck_anterior.png" alt="ì „ë°©" style="height: 160px;vertical-align:middle;">
          </button>
          <button type="button" class="option-button" data-name="neck_location" data-value="ìœ—ë“±">
            ìœ—ë“±<br>
            <img src="image/neck_upper_trapezius.png.png" alt="ìœ—ë“±" style="height: 160px;vertical-align:middle;">
          </button>
          <button type="button" class="option-button" data-name="neck_location" data-value="ë‚ ê°œë¼ˆ ì‚¬ì´">
            ë‚ ê°œë¼ˆ ì‚¬ì´<br>
            <img src="image/neck_scapular_neck.png.png" alt="ë‚ ê°œë¼ˆ ì‚¬ì´" style="height: 160px;vertical-align:middle;">
          </button>
        </div>
      </div>      
    <div class="question" data-group="neck">
      <strong>ëª©: ì–´ë–¤ ìì„¸ì—ì„œ ì•…í™”ë˜ë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="neck_posture" data-value="rotate">ë¨¸ë¦¬ íšŒì „ ì‹œ</button>
        <button type="button" class="option-button" data-name="neck_posture" data-value="flex_ext">ëª© êµ½í˜/ì –í˜ ì‹œ</button>
        <button type="button" class="option-button" data-name="neck_posture" data-value="device">ì¥ì‹œê°„ ìŠ¤ë§ˆíŠ¸í°/PC ì‚¬ìš©</button>
      </div>
    </div>
    <div class="question" data-group="neck">
      <strong>ëª©: í†µì¦ì´ ë°©ì‚¬ë˜ë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="neck_rad" data-value="scapular_rad">ë‚ ê°œë¼ˆ ì‚¬ì´</button>
        <button type="button" class="option-button" data-name="neck_rad" data-value="upper_arm">ì–´ê¹¨ ìœ—íŒ”</button>
        <button type="button" class="option-button" data-name="neck_rad" data-value="headache">ë‘í†µ ë™ë°˜</button>
      </div>
    </div>
    <div class="question" data-group="neck">
      <strong>ëª©: ë™ë°˜ ì¦ìƒì´ ìˆë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="neck_symp" data-value="arm_sens">íŒ” ì €ë¦¼/ê°ê° ì´ìƒ</button>
        <button type="button" class="option-button" data-name="neck_symp" data-value="arm_weak">íŒ” ê·¼ë ¥ ì €í•˜</button>
        <button type="button" class="option-button" data-name="neck_symp" data-value="morning_stiff">ì•„ì¹¨ ê¸°ìƒ ì‹œ ë»£ë»£í•¨, ê³ ê°œ ëŒë¦¬ê¸° í˜ë“¦</button>
      </div>
    </div>
    <div class="question" data-group="neck">
      <strong>ëª©: ê´€ë ¨ ê³¼ê±° ë³‘ë ¥ì´ ìˆë‚˜ìš”?(ì—†ìœ¼ë©´ ë‹¤ìŒ)</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="neck_hist" data-value="disc_stenosis">ê²½ì¶” ë””ìŠ¤í¬/í˜‘ì°©ì¦</button>
        <button type="button" class="option-button" data-name="neck_hist" data-value="trauma_disc">ì™¸ìƒ/ì¶”ê°„íŒ íƒˆì¶œ</button>
        <button type="button" class="option-button" data-name="neck_hist" data-value="ra_as">ë¥˜ë§ˆí‹°ìŠ¤/ê°•ì§ì„± ì²™ì¶”ì—¼</button>
      </div>
    </div>

    <div class="question" data-group="plexus">
      <strong>íŒ”: ì €ë¦¼ ë¶„í¬ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="arm_dist" data-value="entire">íŒ” ì „ì²´</button>
        <button type="button" class="option-button" data-name="arm_dist" data-value="fingers">ì†ê°€ë½ê¹Œì§€</button>
      </div>
    </div>
    <div class="question" data-group="plexus">
      <strong>íŒ”: ì–´ë–¤ ë™ì‘ì—ì„œ ì•…í™”ë˜ë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="arm_trigger" data-value="raise">íŒ” ë¨¸ë¦¬ ìœ„ë¡œ ì˜¬ë¦´ ë•Œ</button>
        <button type="button" class="option-button" data-name="arm_trigger" data-value="lift">ë¬´ê±°ìš´ ë¬¼ê±´ ë“¤ ë•Œ</button>
        <button type="button" class="option-button" data-name="arm_trigger" data-value="lean">ëª¸í†µ ê¸°ìš¸ì¼ ë•Œ</button>
      </div>
    </div>
    <div class="question" data-group="plexus">
      <strong>íŒ”: ê°ê° ì´ìƒì€?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="arm_sensory" data-value="paresthesia">ì €ë¦¼/ì°Œë¦¿í•¨</button>
        <button type="button" class="option-button" data-name="arm_sensory" data-value="burning">í™”ëˆê±°ë¦¼</button>
        <button type="button" class="option-button" data-name="arm_sensory" data-value="specific_finger">íŠ¹ì • ì†ê°€ë½</button>
      </div>
    </div>
    <div class="question" data-group="plexus">
      <strong>íŒ”: ìš´ë™ ì•½í™”ê°€ ìˆë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="arm_weakness" data-value="chopsticks">ì “ê°€ë½ì§ˆ í˜ë“¦</button>
        <button type="button" class="option-button" data-name="arm_weakness" data-value="drops">ë¬¼ê±´ ìì£¼ ë–¨ì–´ëœ¨ë¦¼</button>
        <button type="button" class="option-button" data-name="arm_weakness" data-value="lift_shoulder">ì–´ê¹¨ ë“¤ê¸° ì–´ë ¤ì›€</button>
      </div>
    </div>
    <div class="question" data-group="plexus">
      <strong>íŒ”: ê´€ë ¨ ê³¼ê±° ë³‘ë ¥ì´ ìˆë‚˜ìš”?(ì—†ìœ¼ë©´ ë‹¤ìŒ)</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="arm_hist" data-value="breast_surgery">ìœ ë°©ì•” ìˆ˜ìˆ /ë¦¼í”„ì ˆ ì ˆì œ</button>
        <button type="button" class="option-button" data-name="arm_hist" data-value="radiation">ë°©ì‚¬ì„  ì¹˜ë£Œ ë³‘ë ¥</button>
        <button type="button" class="option-button" data-name="arm_hist" data-value="diabetic_neuropathy">ë‹¹ë‡¨ë³‘ì„± ì‹ ê²½ë³‘ì¦</button>
      </div>
    </div>

    <div class="question" data-group="shoulder">
      <strong>ì–´ê¹¨: í†µì¦ ìœ„ì¹˜ëŠ” ì–´ë””ì¸ê°€ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="sh_location" data-value="anterior">ì• ì–´ê¹¨</button>
        <button type="button" class="option-button" data-name="sh_location" data-value="lateral">ì¸¡ë©´</button>
        <button type="button" class="option-button" data-name="sh_location" data-value="posterior">í›„ë©´</button>
        <button type="button" class="option-button" data-name="sh_location" data-value="ac">ì‡„ê³¨ ìƒë¶€</button>
      </div>
    </div>
    <div class="question" data-group="shoulder">
      <strong>ì–´ê¹¨: ì–´ë–¤ ë™ì‘ì—ì„œ í†µì¦ì´ ì•…í™”ë˜ë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="sh_trigger" data-value="raise">íŒ” ë¨¸ë¦¬ ìœ„ë¡œ ì˜¬ë¦´ ë•Œ</button>
        <button type="button" class="option-button" data-name="sh_trigger" data-value="behind">ë“± ë’¤ë¡œ ëŒë¦´ ë•Œ</button>
        <button type="button" class="option-button" data-name="sh_trigger" data-value="dress_wash">ì˜· ì…ê¸°/ë¨¸ë¦¬ ê°ì„ ë•Œ</button>
      </div>
    </div>
    <div class="question" data-group="shoulder">
      <strong>ì–´ê¹¨: ë°¤ì— í†µì¦ì´ ìˆë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="sh_nocturnal" data-value="side_sleep">ì˜†ìœ¼ë¡œ ëˆ•ê¸° ì–´ë ¤ì›€</button>
        <button type="button" class="option-button" data-name="sh_nocturnal" data-value="wake_pain">ìë‹¤ ê¹° ì •ë„ í†µì¦</button>
      </div>
    </div>
    <div class="question" data-group="shoulder">
      <strong>ì–´ê¹¨: ë™ë°˜ ì¦ìƒì´ ìˆë‚˜ìš”?(ì—†ìœ¼ë©´ ë‹¤ìŒ)</strong>  
      <div class="button-grid">
        <button type="button" class="option-button" data-name="sh_symp" data-value="chopsticks_sh">ì “ê°€ë½ì§ˆ í˜ë“¦</button>
        <button type="button" class="option-button" data-name="sh_symp" data-value="sound">ì–´ê¹¨ì—ì„œ ì†Œë¦¬ë‚¨</button>
        <button type="button" class="option-button" data-name="sh_symp" data-value="reduced">ì–´ê¹¨ ë²”ìœ„ê°€ ì¤„ì–´ë“¦</button>
      </div>
    </div>
     <div class="question" data-group="shoulder">
      <strong>ì–´ê¹¨: ê´€ë ¨ ê³¼ê±° ë³‘ë ¥ì´ ìˆë‚˜ìš”?</strong>
      <div class="button-grid">
        <button type="button" class="option-button" data-name="sh_hist" data-value="rotator_cuff">íšŒì „ê·¼ê°œ íŒŒì—´/ìˆ˜ìˆ </button>
        <button type="button" class="option-button" data-name="sh_hist" data-value="diabetes_thyroid">ë‹¹ë‡¨/ê°‘ìƒì„  ì§ˆí™˜</button>
        <button type="button" class="option-button" data-name="sh_hist" data-value="adhesive_capsulitis">ì˜¤ì‹­ê²¬(ìœ ì°©ì„± ê´€ì ˆë‚­ì—¼)</button>
      </div>
    </div>


    <div class="question" data-group="general">
      <strong>ìµœì¢…) í˜„ì¬ í†µì¦ ì •ë„ëŠ” ì–´ëŠ ì •ë„ì¸ê°€ìš”? (0~10)</strong>
      <div class="pain-description">
        <strong>0ì :</strong> ì „í˜€ ì•„í”„ì§€ ì•ŠìŒ<br>
        <strong>5ì :</strong> ì¼ìƒ ì§€ì¥ ì—†ì§€ë§Œ ì‹ ê²½ ì“°ì„<br>
        <strong>10ì :</strong> ê²¬ë””ê¸° ì–´ë ¤ìš¸ ì •ë„ë¡œ ì‹¬í•¨
      </div>
      <div class="pain-grid">
        <button type="button" class="score-button" data-score="0">0</button>
        <button type="button" class="score-button" data-score="1">1</button>
        <button type="button" class="score-button" data-score="2">2</button>
        <button type="button" class="score-button" data-score="3">3</button>
        <button type="button" class="score-button" data-score="4">4</button>
        <button type="button" class="score-button" data-score="5">5</button>
        <button type="button" class="score-button" data-score="6">6</button>
        <button type="button" class="score-button" data-score="7">7</button>
        <button type="button" class="score-button" data-score="8">8</button>
        <button type="button" class="score-button" data-score="9">9</button>
        <button type="button" class="score-button" data-score="10">10</button>
      </div>
    </div>

    <div class="center">
      <button type="button" class="nav-button" id="prevBtn">ì´ì „</button>
      <button type="button" class="nav-button" id="nextBtn">ë‹¤ìŒ</button>
      <button type="submit" class="nav-button" id="submitBtn" style="display:none;background:#d32f2f;">ì œì¶œ</button>
    </div>

  </form>

  <div id="thankyou">
    <p>âœ”ï¸ ì„¤ë¬¸ì´ ì •ìƒì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
    <p>ì˜ë£Œì§„ì—ê²Œ ê²°ê³¼ê°€ ì „ì†¡ë˜ì—ˆìœ¼ë‹ˆ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
  </div>

  <script>
    const qs    = [...document.querySelectorAll('.question')];
    const next  = document.getElementById('nextBtn');
    const prev  = document.getElementById('prevBtn');
    const sub   = document.getElementById('submitBtn');
    let idx=0, selectedAreas=[];

    function getVisible(){
      return qs.map((q,i)=>({q,i}))
              .filter(o=>o.q.style.display!=='none')
              .map(o=>o.i);
    }
    function showCurrent(){
      const vis=getVisible(), showIdx=vis[idx];
      qs.forEach((q,i)=>q.classList.toggle('active',i===showIdx));
      prev.style.display= idx===0?'none':'inline-block';
      next.style.display= idx===vis.length-1?'none':'inline-block';
      sub .style.display= idx===vis.length-1?'inline-block':'none';
    }
    next.onclick=()=>{ if(idx<getVisible().length-1) idx++; showCurrent(); }
    prev.onclick=()=>{ if(idx>0) idx--; showCurrent(); }

    // â–¼â–¼â–¼ ì˜µì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼) â–¼â–¼â–¼
    document.querySelectorAll('.option-button').forEach(btn => {
        const questionElement = btn.closest('.question');
        const questionStrongText = questionElement.querySelector('strong').innerText;
        const dataName = btn.dataset.name;
        const dataValue = btn.dataset.value;

        if (questionStrongText.includes('1. í†µì¦ ë¶€ìœ„ê°€ ì–´ë””ì¸ê°€ìš”?')) {
            btn.onclick = () => {
                btn.classList.toggle('selected');
                if (dataValue) {
                    if (btn.classList.contains('selected')) {
                        if (!selectedAreas.includes(dataValue)) {
                            selectedAreas.push(dataValue);
                        }
                    } else {
                        selectedAreas = selectedAreas.filter(x => x !== dataValue);
                    }
                }
                qs.forEach(q => {
                    q.style.display = (q.dataset.group === 'general' || selectedAreas.includes(q.dataset.group)) ? '' : 'none';
                });
                idx = 0;
                showCurrent();
            };
        } else if (dataName === 'onset') {
            btn.onclick = () => {
                document.querySelectorAll('.option-button[data-name="onset"]').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
            };
        } else {
            btn.onclick = () => {
                btn.classList.toggle('selected');
            };
        }
    });

    document.querySelectorAll('.score-button').forEach(b => {
        b.onclick = () => {
            document.querySelectorAll('.score-button.selected').forEach(sb => sb.classList.remove('selected'));
            b.classList.add('selected');
        };
    });
    // â–²â–²â–² ì˜µì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë â–²â–²â–²

    // Impression ìƒì„± í•¨ìˆ˜ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    function generateImpression(sel) {
      const imps = [];
      // Face
      if (sel.area.includes('face')) {
        if (sel.face_char==='electric') imps.push('Trigeminal Neuralgia (ì‚¼ì°¨ì‹ ê²½í†µ)');
        if (sel.face_location==='jaw' && sel.face_symp==='jaw_lock')
          imps.push('TMJ Dysfunction (í„±ê´€ì ˆ ê¸°ëŠ¥ì¥ì• )');
        if (sel.face_char==='aching' && sel.onset==='gradual')
          imps.push('Atypical Facial Pain (ë¹„ì „í˜• ì•ˆë©´í†µ)');
        if (sel.face_trigger==='wash' && sel.face_location==='jaw')
          imps.push('Hyoid Syndrome (ì„¤ê³¨ ì¦í›„êµ°)');
        if (sel.face_symp==='sensory')
          imps.push('Reflex Sympathetic Dystrophy (ì•ˆë©´ RSD)');
      }
      // Neck & Plexus
      if (sel.area.includes('neck')) {
        if (sel.neck_location==='scapular_neck' && sel.neck_posture==='rotate')
          imps.push('Cervical Facet Syndrome (ê²½ì¶” ê´€ì ˆë©´ ì¦í›„êµ°)');
        if (sel.neck_rad==='upper_arm' || sel.neck_symp==='arm_sens')
          imps.push('Cervical Radiculopathy (ê²½ì¶” ì‹ ê²½ê·¼ë³‘ì¦)');
        if (sel.onset==='recurrent' && sel.neck_posture==='device')
          imps.push('Fibromyalgia of Cervical Musculature (ê²½ì¶” ê·¼ìœ¡ ì„¬ìœ ê·¼í†µ)');
        if (sel.onset==='trauma' && sel.neck_location==='lateral')
          imps.push('Cervical Strain (ê²½ì¶” ì—¼ì¢Œ)');
        if (sel.neck_posture==='flex_ext' && sel.neck_location==='anterior')
          imps.push('Longus Colli Tendinitis (ë¡±êµ¬ìŠ¤ì½œë¦¬ ê±´ì—¼)');
        if (sel.neck_symp==='morning_stiff')
          imps.push('Cervicothoracic Interspinous Bursitis (ê²½í‰ì¶”ê·¹ê°„ ì ì•¡ë‚­ì—¼)');
      }
      if (sel.area.includes('plexus')) {
        if (sel.arm_dist==='entire' && sel.arm_weakness==='chopsticks')
          imps.push('Brachial Plexopathy (ìƒì™„ì‹ ê²½ì´ ë³‘ì¦)');
        if (sel.arm_trigger==='raise' && sel.arm_weakness==='chopsticks')
          imps.push('Thoracic Outlet Syndrome (í‰ê³½ì¶œêµ¬ ì¦í›„êµ°)');
      }
      // Shoulder
      if (sel.area.includes('shoulder')) {
        if (sel.onset==='gradual' && sel.sh_nocturnal==='side_sleep')
          imps.push('Shoulder Arthritis Pain (ì–´ê¹¨ ê´€ì ˆì—¼ í†µì¦)');
        if (sel.sh_location==='ac' && sel.sh_trigger==='behind')
          imps.push('Acromioclavicular Joint Pain (ê²¬ë´‰ì‡„ê³¨ ê´€ì ˆí†µ)');
        if (sel.sh_location==='lateral' && sel.sh_trigger==='raise')
          imps.push('Subdeltoid Bursitis (ì‚¼ê°ê·¼í•˜ ì ì•¡ë‚­ì—¼)');
        if (sel.sh_location==='anterior' && sel.sh_trigger==='dress_wash')
          imps.push('Bicipital Tendinitis (ì´ë‘ê±´ì—¼)');
        if (sel.sh_symp==='reduced')
          imps.push('Adhesive Capsulitis (ìœ ì°©ì„± ê´€ì ˆë‚­ì—¼)');
        if (sel.sh_symp==='sound' && sel.sh_nocturnal==='wake_pain')
          imps.push('Rotator Cuff Tear / Supraspinatus Syndrome');
        if (sel.sh_location==='posterior' && sel.sh_trigger==='behind')
          imps.push('Teres Major Syndrome (ëŒ€ì›ê·¼ ì¦í›„êµ°)');
        if (sel.sh_trigger==='behind' && sel.sh_symp==='reduced')
          imps.push('Scapulocostal Syndrome (ê²¬ê°‘ëŠ‘ê³¨ ì¦í›„êµ°)');
        if (sel.onset==='gradual' && sel.score>=8)
          imps.push('Avascular Necrosis of GH Joint (ê²¬ê´€ì ˆ ë¬´í˜ˆì„± ê´´ì‚¬) ê°ë³„ê¶Œì¥');
      }
      if (sel.score>=8)
        imps.push('ì‹¬í•œ í†µì¦: ì ê·¹ì  ì§„í†µ ë° ì˜ìƒê²€ì‚¬ ê¶Œì¥');
      if (!imps.length)
        imps.push('ì¶”ê°€ ì§„ì°° ë° ì˜ìƒê²€ì‚¬ ê¶Œì¥');
      return imps;
    }

    // Google Sheets ì—°ë™ URL (ì‹¤ì œ URLë¡œ êµì²´ í•„ìš”)
    const SHEET_URL = 'https://script.google.com/macros/s/AKfycbwfrYtGVqXL264bU2JmgBrFTScdXfdI_NSaLFvm2UsSSrP_wwR2dr6coaNtuOax9q4-/exec'; // ì‹¤ì œ URLë¡œ êµì²´í•˜ì„¸ìš”

// ----- ë¬¸ì§„ ì œì¶œ ì´ë²¤íŠ¸ -----
document.getElementById('form').addEventListener('submit', async e => {
      e.preventDefault();

      // 1. í™˜ìì •ë³´ ì…ë ¥ ê²€ì¦ (í™˜ìë²ˆí˜¸, ìƒë…„ì›”ì¼ 8ìë¦¬)
      const pid = document.getElementById('patientIdInput').value.trim();
      const pbirth = document.getElementById('patientBirthInput').value.trim();

      if (!pid) {
        alert('í™˜ì ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
        idx = 0;
        showCurrent();
        return;
      }
      // ìƒë…„ì›”ì¼: 8ìë¦¬ ìˆ«ìë§Œ í—ˆìš©
      if (!pbirth || !/^\d{8}$/.test(pbirth)) {
        alert('ìƒë…„ì›”ì¼ì„ 8ìë¦¬ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”! (ì˜ˆ: 19900101)');
        idx = 0;
        showCurrent();
        return;
      }

      // 2. ê¸°ì¡´ ë°ì´í„° êµ¬ì¡° ì¤€ë¹„
      const formData = {
        patient_id: pid,
        patient_birth: pbirth,
        area: [],
        onset: "",
        details: [],
        score: 0,
        impression: []
      };

      // í†µì¦ ë¶€ìœ„ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)
      document.querySelectorAll('.question[data-group="general"] .option-button.selected').forEach(btn => {
        if (btn.closest('.question').querySelector('strong').innerText.includes('1. í†µì¦ ë¶€ìœ„')) {
          if (btn.dataset.value) {
            formData.area.push(btn.dataset.value);
          }
        }
      });

      // ë°œìƒ ì‹œê¸° (ë‹¨ì¼ ì„ íƒ)
      const onsetBtn = document.querySelector('.option-button[data-name="onset"].selected');
      if (onsetBtn) {
        formData.onset = onsetBtn.dataset.value || "";
      }

      // í†µì¦ ì ìˆ˜ (ë‹¨ì¼ ì„ íƒ)
      const scoreBtn = document.querySelector('.score-button.selected');
      if (scoreBtn) {
        formData.score = parseInt(scoreBtn.dataset.score) || 0;
      }

      // ë‚˜ë¨¸ì§€ ëª¨ë“  ì„ íƒëœ ìƒì„¸ ì •ë³´ ìˆ˜ì§‘
      document.querySelectorAll('.option-button.selected').forEach(btn => {
        const questionText = btn.closest('.question').querySelector('strong').innerText;
        if (!questionText.includes('1. í†µì¦ ë¶€ìœ„') && btn.dataset.name !== 'onset') {
          const detail = {
            name: btn.dataset.name || "unknown",
            value: btn.dataset.value || btn.innerText,
            text: btn.innerText
          };
          formData.details.push(detail);
        }
      });

      // ì„í”„ë ˆì…˜ ìƒì„±
      const selForImpression = {
        area: formData.area,
        onset: formData.onset,
        score: formData.score
      };
      formData.details.forEach(detail => {
        selForImpression[detail.name] = detail.value;
      });
      formData.impression = generateImpression(selForImpression);

      // ì œì¶œ ìƒíƒœ í‘œì‹œ
      sub.innerText = 'ì œì¶œ ì¤‘...';
      sub.disabled = true;

      try {
        // JSON ë°ì´í„° ì§ë ¬í™”
        const jsonData = JSON.stringify(formData);

        // Google Apps Scriptë¡œ ë°ì´í„° ì „ì†¡ (CORS ë¬¸ì œ ë°©ì§€)
        await fetch(SHEET_URL, {
          method: 'POST',
          mode: 'no-cors',
          body: jsonData
        });

        // ì„œë²„ ì‘ë‹µì„ í™•ì¸í•˜ì§€ ì•Šê³  ë°”ë¡œ ì„±ê³µ ì²˜ë¦¬
        document.getElementById('form').style.display = 'none';
        document.querySelector('h1').style.display = 'none';
        document.getElementById('thankyou').style.display = 'block';

        sub.innerText = 'ì œì¶œ';
        sub.disabled = false;

      } catch (err) {
        console.error("ì œì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", err);
        alert(`ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n${err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}\n\në‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.`);
        sub.innerText = 'ì œì¶œ';
        sub.disabled = false;
      }
    });

    document.addEventListener('DOMContentLoaded', showCurrent);
  </script>
</body>
</html>